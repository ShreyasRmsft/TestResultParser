#!/bin/bash -eo pipefail
# Limit maxWorkers to 3 to avoid OOM on CircleCI
yarn test-only --maxWorkers 3
^D^Dyarn run v1.1.0
$ node --max_old_space_size=4096 node_modules/jest/bin/jest.js --verbose "--maxWorkers" "3"
 PASS  __tests__/registries/npm-registry.js (5.615s)
  normalizeConfig
    ✓ environment is replaced (111ms)
    ✓ path normalization doesn't affect all options (1ms)
    ✓ resolve path to current directory (43ms)
    ✓ resolve path to home directory
    ✓ resolve keep path to rooted directory (1ms)
    ✓ handles missing HOME (1ms)
  request
    ✓ should call requestManager.request with url (321ms)
    ✓ should add `npm-otp` header (1ms)
    using npm as default registry and using private registry for scoped packages
      ✓ with request url yarn in context of package yarn auth is not sent (2ms)
      ✓ with request url @yarn%2fcore in context of package @yarn/core auth is not sent (1ms)
      ✓ with request url -/package/yarn/dist-tags in context of package yarn auth is not sent (1ms)
      ✓ with request url -/package/@yarn%2fcore/dist-tags in context of package @yarn/core auth is not sent (1ms)
      ✓ with request url -/user/token/abcdef auth is not sent (3ms)
      ✓ with request url https://registry.npmjs.org/dist/-/@yarn-core-1.0.0.tgz in context of package @yarn/core auth is not sent (1ms)
      ✓ with request url https://registry.yarnpkg.com/dist/-/@yarn-core-1.0.0.tgz in context of package @yarn/core auth is not sent (1ms)
      ✓ with request url https://registry.yarnpkg.com/dist/-/@yarn-core-1.0.0.tgz auth is not sent (1ms)
      ✓ with request url https://some.cdn.com/@yarn/core.tgz in context of package @yarn/core auth is not sent (1ms)
      ✓ with request url https://some.cdn.com/@yarn/core.tgz auth is not sent (2ms)
      ✓ with request url @private/pkg in context of package @private/pkg auth is scopedPrivateAuthToken (1ms)
      ✓ with request url https://some.cdn.com/some-hash/@private-pkg-1.0.0.tar.gz in context of package @private/pkg auth is not sent (3ms)
      ✓ with request url https://some.cdn.com/@private/pkg auth is not sent (3ms)
    using scoped packages in both npm and private registry
      ✓ with request url yarn in context of package yarn auth is not sent (1ms)
      ✓ with request url @yarn%2fcore in context of package @yarn/core auth is scopedNpmAuthToken (1ms)
      ✓ with request url -/package/yarn/dist-tags in context of package yarn auth is not sent (1ms)
      ✓ with request url -/package/@yarn%2fcore/dist-tags in context of package @yarn/core auth is scopedNpmAuthToken (1ms)
      ✓ with request url -/user/token/abcdef auth is not sent (1ms)
      ✓ with request url https://registry.npmjs.org/dist/-/@yarn-core-1.0.0.tgz in context of package @yarn/core auth is scopedNpmAuthToken (1ms)
      ✓ with request url https://registry.yarnpkg.com/dist/-/@yarn-core-1.0.0.tgz in context of package @yarn/core auth is scopedNpmAuthToken (1ms)
      ✓ with request url https://registry.yarnpkg.com/dist/-/@yarn-core-1.0.0.tgz auth is not sent (1ms)
      ✓ with request url https://some.cdn.com/@yarn/core.tgz in context of package @yarn/core auth is not sent (2ms)
      ✓ with request url https://some.cdn.com/@yarn/core.tgz auth is not sent (2ms)
      ✓ with request url @private/pkg in context of package @private/pkg auth is scopedPrivateAuthToken (1ms)
      ✓ with request url https://some.cdn.com/some-hash/@private-pkg-1.0.0.tar.gz in context of package @private/pkg auth is not sent (1ms)
      ✓ with request url https://some.cdn.com/@private/pkg auth is not sent (1ms)
    using authenticated npm and using private registry for scoped packages
      ✓ with request url yarn in context of package yarn auth is not sent (3ms)
      ✓ with request url @yarn%2fcore in context of package @yarn/core auth is scopedNpmAuthToken (1ms)
      ✓ with request url -/package/yarn/dist-tags in context of package yarn auth is not sent (1ms)
      ✓ with request url -/package/@yarn%2fcore/dist-tags in context of package @yarn/core auth is scopedNpmAuthToken (2ms)
      ✓ with request url -/user/token/abcdef auth is not sent (1ms)
      ✓ with request url https://registry.npmjs.org/dist/-/@yarn-core-1.0.0.tgz in context of package @yarn/core auth is scopedNpmAuthToken (1ms)
      ✓ with request url https://registry.yarnpkg.com/dist/-/@yarn-core-1.0.0.tgz in context of package @yarn/core auth is scopedNpmAuthToken (1ms)
      ✓ with request url https://registry.yarnpkg.com/dist/-/@yarn-core-1.0.0.tgz auth is not sent (1ms)
      ✓ with request url https://some.cdn.com/@yarn/core.tgz in context of package @yarn/core auth is not sent (1ms)
      ✓ with request url https://some.cdn.com/@yarn/core.tgz auth is not sent (2ms)
      ✓ with request url @private/pkg in context of package @private/pkg auth is scopedPrivateAuthToken (1ms)
      ✓ with request url https://some.cdn.com/some-hash/@private-pkg-1.0.0.tar.gz in context of package @private/pkg auth is not sent (1ms)
      ✓ with request url https://some.cdn.com/@private/pkg auth is not sent (2ms)
    using npm with always-auth and using private registry for scoped packages
      ✓ with request url yarn in context of package yarn auth is npmAuthToken (1ms)
      ✓ with request url @yarn%2fcore in context of package @yarn/core auth is npmAuthToken (1ms)
      ✓ with request url -/package/yarn/dist-tags in context of package yarn auth is npmAuthToken (1ms)
      ✓ with request url -/package/@yarn%2fcore/dist-tags in context of package @yarn/core auth is npmAuthToken (1ms)
      ✓ with request url -/user/token/abcdef auth is npmAuthToken (1ms)
      ✓ with request url https://registry.npmjs.org/dist/-/@yarn-core-1.0.0.tgz in context of package @yarn/core auth is npmAuthToken (1ms)
      ✓ with request url https://registry.yarnpkg.com/dist/-/@yarn-core-1.0.0.tgz in context of package @yarn/core auth is npmAuthToken (1ms)
      ✓ with request url https://registry.yarnpkg.com/dist/-/@yarn-core-1.0.0.tgz auth is npmAuthToken (1ms)
      ✓ with request url https://some.cdn.com/@yarn/core.tgz in context of package @yarn/core auth is not sent (2ms)
      ✓ with request url https://some.cdn.com/@yarn/core.tgz auth is not sent (2ms)
      ✓ with request url @private/pkg in context of package @private/pkg auth is scopedPrivateAuthToken (1ms)
      ✓ with request url https://some.cdn.com/some-hash/@private-pkg-1.0.0.tar.gz in context of package @private/pkg auth is not sent (1ms)
      ✓ with request url https://some.cdn.com/@private/pkg auth is not sent (1ms)
    using private registry as default registry and using scoped packages on npm registry
      ✓ with request url yarn in context of package yarn auth is privateAuthToken (1ms)
      ✓ with request url @yarn%2fcore in context of package @yarn/core auth is scopedNpmAuthToken (1ms)
      ✓ with request url -/package/yarn/dist-tags in context of package yarn auth is privateAuthToken (1ms)
      ✓ with request url -/package/@yarn%2fcore/dist-tags in context of package @yarn/core auth is scopedNpmAuthToken (1ms)
      ✓ with request url -/user/token/abcdef auth is privateAuthToken (1ms)
      ✓ with request url https://registry.npmjs.org/dist/-/@yarn-core-1.0.0.tgz in context of package @yarn/core auth is scopedNpmAuthToken (1ms)
      ✓ with request url https://registry.yarnpkg.com/dist/-/@yarn-core-1.0.0.tgz in context of package @yarn/core auth is scopedNpmAuthToken (1ms)
      ✓ with request url https://registry.yarnpkg.com/dist/-/@yarn-core-1.0.0.tgz auth is not sent (2ms)
      ✓ with request url https://some.cdn.com/@yarn/core.tgz in context of package @yarn/core auth is not sent (1ms)
      ✓ with request url https://some.cdn.com/@yarn/core.tgz auth is not sent (1ms)
      ✓ with request url @private/pkg in context of package @private/pkg auth is privateAuthToken (1ms)
      ✓ with request url https://some.cdn.com/some-hash/@private-pkg-1.0.0.tar.gz in context of package @private/pkg auth is not sent (2ms)
      ✓ with request url https://some.cdn.com/@private/pkg auth is not sent (1ms)
    registry url and request url path sensitivity
      ✓ with request url https://registry.myorg.com/api/npm/registry/private---pkg.tar.gz in context of package @private/pkg auth is scopedPrivateAuthToken (1ms)
      ✓ with request url https://registry.myorg.com/api/packages/private---pkg.tar.gz in context of package @private/pkg auth is not sent (1ms)
    using custom-host-suffix for registries where pathnames play a role
      ✓ with request url @private/pkg in context of package @private/pkg auth is scopedPrivateAuthToken (1ms)
      ✓ with request url https://some.cdn.com/some-hash/@private-pkg-1.0.0.tar.gz in context of package @private/pkg auth is not sent (2ms)
      ✓ with request url https://some.cdn.com/@private/pkg auth is not sent (1ms)
      ✓ with request url https://registry.myorg.com/api/packages/private---pkg.tar.gz in context of package @private/pkg auth is scopedPrivateAuthToken (1ms)
    using multiple config entries for registries where pathnames play a role
      ✓ with request url @private/pkg in context of package @private/pkg auth is scopedPrivateAuthToken (2ms)
      ✓ with request url https://some.cdn.com/some-hash/@private-pkg-1.0.0.tar.gz in context of package @private/pkg auth is not sent (1ms)
      ✓ with request url https://some.cdn.com/@private/pkg auth is not sent (2ms)
      ✓ with request url https://registry.myorg.com/api/packages/private---pkg.tar.gz in context of package @private/pkg auth is scopedPrivateAuthToken (2ms)
    using username/password config for registries where pathnames play a role
      ✓ with request url @private/pkg in context of package @private/pkg auth is c2NvcGVkUHJpdmF0ZVVzZXJuYW1lOu+/ve+/vSl577+977+977+977+9eO+/ve+/ve+/vQor (1ms)
      ✓ with request url https://some.cdn.com/some-hash/@private-pkg-1.0.0.tar.gz in context of package @private/pkg auth is not sent (2ms)
      ✓ with request url https://some.cdn.com/@private/pkg auth is not sent (2ms)
      ✓ with request url https://registry.myorg.com/api/packages/private---pkg.tar.gz in context of package @private/pkg auth is c2NvcGVkUHJpdmF0ZVVzZXJuYW1lOu+/ve+/vSl577+977+977+977+9eO+/ve+/ve+/vQor (2ms)
  isRequestToRegistry functional test
    ✓ request to registry url matching (14ms)
    ✓ isRequestToRegistry with custom host prefix (2ms)
  isScopedPackage functional test
    ✓ identifies scope correctly (1ms)
  getRequestUrl functional test
    ✓ returns pathname when it is a full URL
    ✓ correctly handles registries lacking a trailing slash (1ms)
  getPossibleConfigLocations
    ✓ searches recursively to home directory (1014ms)
  checkOutdated functional test
    ✓ homepage URL from top level (502ms)
    ✓ homepage URL fallback to wanted package manifest (2ms)
    ✓ repository URL from top level (1ms)
    ✓ repository URL fallback to wanted package manifest (1ms)
    ✓ unpublished package (no versions) (43ms)
    ✓ latest version fallback to wanted package manifest (2ms)
    ✓ package with an empty response (1ms)

 PASS  __tests__/package-hoister.js
  ✓ Produces valid destination paths for scoped modules (1324ms)
  ✓ hoists dependencies of dependencies up to root level when no version conflicts exist (19ms)
  ✓ leaves dependencies of dependencies at leaf level when version conflict exists (4ms)
  ✓ eliminates duplicates when multiple packages depend on the same package (5ms)
  ✓ eliminates duplicates when version conflicts exist (10ms)
  ✓ uses the modulesFolder configuration option as the first part of the path (3ms)
  ✓ does not include ignored packages or their dependencies (1ms)
  ✓ includes ignored packages dependencies if another non-ignored package depends on it (2ms)
  ✓ considers ignored packages when determining hoisting (3ms)
  ✓ will hoist packages under subdirectories when they cannot hoist to root (5ms)
  nohoist
    ✓ nohoist can be turned off by disable workspaces (workspaces-experimental) (2ms)
    ✓ nohoist pkg will be duplicated independent of the hoisted version (1ms)
    ✓ nohoist pkg will NOT be duplicated within the same branch (2ms)
    ✓ can dedupe and avoid circular reference (1ms)
    ✓ can handle conflict version (1ms)
    ✓ nohoist matches package regardless version (1ms)
    ✓ can detect circular reference (2ms)
    ✓ can nohoist a linked package (9ms)
    ✓ can disable hoist for the whole branch (2ms)
    ✓ can disable hoist for particular package tree (2ms)
    ✓ originalParentPath shows before-hoist dependency tree path (2ms)
    ✓ previousPaths should reflect hoist history (1ms)
    nohoist = hoist to the top of its branch instead of root
      ✓ shallow nohoist (4ms)
      ✓ deep nohoist (6ms)
    nohoistList pattern matching
      ✓ match explicit path (2ms)
      ✓ match glob pattern (5ms)
    nohoist with workspaces context
      disable hoist for a package
        ✓ from root for all workspaces (95ms)
        ✓ from root for a specific workspaces (2ms)
        ✓ from workspace (2ms)
      workspace depends on another workspace
        ✓ can nohoist dependent workspace just like any package (2ms)
        ✓ all workspaces nohoist will be honored (3ms)

 PASS  __tests__/commands/upgrade.js (20.467s)
  ✓ throws if lockfile is out of date (3060ms)
  ✓ works with no arguments (4688ms)
  ✓ upgrades transitive deps when no arguments
  ✓ does not upgrade transitive deps that are also a direct dependency
  ✓ does not upgrade transitive deps when specific package upgraded
  ✓ works with single argument (1ms)
  ✓ works with multiple arguments (385ms)
  ✓ respects dependency type
  ✓ respects --ignore-engines flag (535ms)
  ✓ upgrades from fixed version to latest
  ✓ upgrades from fixed version to latest with workspaces
  ✓ works with just a pattern
  ✓ works with arguments and a pattern (1ms)
  ✓ upgrades to latest matching package.json semver when no package name passed
  ✓ --latest upgrades to latest ignoring package.json when no package name passed
  ✓ --latest preserves "<=" semver range
  ✓ --latest preserves "^" semver range (1ms)
  ✓ --latest preserves "~" semver range
  ✓ --latest defaults to "^" semver range if existing range is complex
  ✓ sets new version range to caret when --caret and --latest are passed
  ✓ sets new version range to tilde when --tilde and --latest are passed (1ms)
  ✓ sets new version range to exact when --exact and --latest are passed
  ✓ upgrades to latest matching semver when package name passed with version
  ✓ --latest upgrades to passed in version when package name passed with version
  ✓ upgrades to latest matching package.json semver when package name passed (1ms)
  ✓ upgrades dependency packages not in registry (2375ms)
  ✓ upgrades dev dependency packages not in registry
  ✓ upgrades optional dependency packages not in registry
  ✓ informs the type of dependency after upgrade (6258ms)
  ✓ warns when peer dependency is not met after upgrade (2618ms)
  ✓ doesn't warn when peer dependency is still met after upgrade
  ✓ doesn't warn when upgrading a devDependency
  ✓ can prune the offline mirror
  ✓ respects --scope flag
  ✓ respects --scope flag with caret (1ms)
  ✓ --latest works if there is an install script on a hoisted dependency
  ✓ upgrade to workspace root preserves child dependencies
  ✓ upgrade to workspace child preserves root dependencies
  ✓ latest flag does not downgrade from a beta

 PASS  __tests__/commands/install/workspaces-install.js (5.393s)
  ✓ workspaces don't work with disabled configuration in .yarnrc (818ms)
  ✓ workspaces don't work on non private projects
  ✓ workspaces don't work with duplicate names (379ms)
  ✓ workspaces warn and get ignored if they don't have a name and a version (660ms)
  ✓ installs workspaces dependencies into root folder (2189ms)
  ✓ install should install unhoistable dependencies in workspace node_modules
  ✓ install should link workspaces that refer each other
  ✓ install should not link workspaces that refer not compatible version of another workspace
  ✓ install should not link a workspace if the version is not compatible
  ✓ install should prioritize non workspace dependency at root over the workspace symlink
  ✓ install should install subdependencies of workspaces
  ✓ install should install subdependencies of workspaces that are not referenced in other workspaces (2ms)
  ✓ install should install dev dependencies of workspaces
  ✓ install should not install dev dependencies of workspaces in production mode
  ✓ install should work correctly for workspaces that have similar names
  ✓ check command should work (67ms)
  ✓ install should link binaries at root and in workspace dependents
  ✓ install should ignore node_modules in workspaces when used with **/*
  ✓ install should link binaries properly when run from child workspace (513ms)
  install should ignore deep node_modules in workspaces
    ✓ without nohoist (133ms)
    ✓ with nohoist (135ms)
  nohoist
    ✓ exclude packages by workspace
    ✓ disable all hoist for every workspace
    ✓ disable some hoist for every workspace
    ✓ disable hoisting package across versions

 PASS  __tests__/commands/install/integration.js (95.187s)
  ✓ install should not hoist packages above their peer dependencies (7659ms)
  ✓ install should resolve peer dependencies from same subtrees (134ms)
  ✓ install optional subdependencies by default (194ms)
  ✓ installing with --ignore-optional should not install optional subdependencies (122ms)
  ✓ running install inside a workspace should run the install from the root of the workspace (214ms)
  ✓ packages installed through the link protocol should validate all peer dependencies (86ms)
  ✓ installing a package with a renamed file should not delete it (65ms)
  ✓ installing a new package should correctly update it, even if the files mtime didn't change (2118ms)
  ✓ properly find and save build artifacts (783ms)
  ✓ reading a lockfile should not optimize it (15249ms)
  ✓ creates a symlink to a directory when using the link: protocol (39ms)
  ✓ creates a symlink to a non-existing directory when using the link: protocol (48ms)
  ✓ resolves the symlinks relative to the package path when using the link: protocol; not the node_modules (50ms)
  ✓ resolves the symlinks of other symlinked packages relative to the package using the link: protocol (41ms)
  ✓ replace the symlink when it changes, when using the link: protocol (41ms)
  ✓ changes the cache path when bumping the cache version (628ms)
  ✓ changes the cache directory when bumping the cache version (560ms)
  ✓ removes extraneous files that aren't in module or artifacts (333ms)
  ✓ production mode with deduped dev dep shouldn't be removed (327ms)
  ✓ production mode dep on package in dev deps shouldn't be removed (96ms)
  ✓ hoisting should factor ignored dependencies (340ms)
  ✓ --production flag ignores dev dependencies (83ms)
  ✓ --production flag does not link dev dependency bin scripts (727ms)
  ✓ root install with optional deps (10300ms)
  ✓ install file: protocol with relative paths (166ms)
  ✓ install file: protocol without force retains installed package (59ms)
  ✓ install file: protocol with force re-installs local package (93ms)
  ✓ install file: local packages with local dependencies (210ms)
  ✓ install file: install without manifest of dependency (128ms)
  ✓ install file: link file dependencies (51ms)
  ✓ install file: protocol (46ms)
  ✓ install with file: protocol as default (69ms)
  ✓ don't install with file: protocol as default if target is a file (103ms)
  ✓ don't install with implicit file: protocol if target does not have package.json (28ms)
  ✓ install with explicit file: protocol if target does not have package.json (252ms)
  ✓ don't install with file: protocol as default if target is valid semver (62ms)
  ✓ don't hang when an install script tries to read from stdin (214ms)
  ✓ install file: dedupe dependencies 1 (65ms)
  ✓ install file: dedupe dependencies 2 (169ms)
  ✓ install file: dedupe dependencies 3 (57ms)
  ✓ install everything when flat is enabled (93ms)
  ✓ install renamed packages (156ms)
  ✓ install from git cache (110ms)
  ✓ install from github (299ms)
  ✓ check and install should verify integrity in the same way when flat (82ms)
  ✓ check should verify that top level dependencies are installed correctly (79ms)
  ✓ install should run install scripts in the order of dependencies (507ms)
  ✓ install with comments in manifest (47ms)
  ✓ install with comments in manifest resolutions does not result in warning (50ms)
  ✓ install with null versions in manifest (71ms)
  ✓ run install scripts in the order when one dependency does not have install script (619ms)
  ✓ install should circumvent circular dependencies (84ms)
  ✓ install should resolve circular dependencies 2 (9969ms)
  ✓ install should be idempotent (1131ms)
  ✓ install should authenticate integrity field with sha1 checksums (115ms)
  ✓ install should authenticate integrity field with sha512 checksums (67ms)
  ✓ install should authenticate integrity field with sha384 checksums (82ms)
  ✓ install should authenticate integrity field with options (72ms)
  ✓ install should authenticate integrity field with combined sha1 and sha512 checksums (203ms)
  ✓ install should authenticate integrity with multiple differing sha1 checksums (152ms)
  ✓ install should authenticate integrity with multiple differing sha512 checksums (100ms)
  ✓ install should authenticate integrity with wrong sha1 and right sha512 checksums (122ms)
  ✓ install should fail to authenticate integrity with correct sha1 and incorrect sha512 (132ms)
  ✓ install should fail to authenticate on sha512 integrity mismatch (79ms)
  ✓ install should fail to authenticate on sha1 integrity mismatch (101ms)
  ✓ install should not create the integrity field if missing and auto-add-integrity is false (91ms)
  ✓ install should not create integrity field if not present and in offline mode (125ms)
  ✓ install should ignore existing hash if integrity is present even if it fails to authenticate it (58ms)
  ✓ install should ignore unknown integrity algorithms if it has other options in the sri (68ms)
  ✓ install should fail if the only algorithms in the sri are unknown (168ms)
  ✓ install should fail if the sri is malformed (43ms)
  ✓ install should fail with unsupported algorithms (42ms)
  ✓ install should update integrity in yarn.lock (--update-checksums)
  ✓ install should update malformed integrity string in yarn.lock (--update-checksums) (1ms)
  ✓ install cache symlinks properly (189ms)
  ✓ install a scoped module from authed private registry (146ms)
  ✓ install a scoped module from authed private registry with a missing trailing slash (139ms)
  ✓ install of scoped package with subdependency conflict should pass check (282ms)
  ✓ install a module with incompatible optional dependency should skip dependency (89ms)
  ✓ install a module with incompatible optional dependency should skip transient dependencies (75ms)
  ✓ install a module with optional dependency should skip incompatible transient dependency (99ms)
  ✓ optional dependency that fails to build should not be installed (252ms)
  ✓ failing dependency of optional dependency should not be installed (410ms)
  ✓ a subdependency of an optional dependency that fails should be installed (390ms)
  ✓ a sub-dependency should be non-optional if any parents mark it non-optional (172ms)
  ✓ should not loose dependencies when installing with --production (25825ms)
  ✓ a allows dependency with [] in os cpu requirements (167ms)
  ✓ should skip integrity check and do install when --skip-integrity-check flag is passed (115ms)
  ✓ bailout should work with --production flag too (90ms)
  ✓ package version resolve should be deterministic (395ms)
  ✓ transitive file: dependencies should work (53ms)
  ✓ unbound transitive dependencies should not conflict with top level dependency (104ms)
  ✓ manifest optimization respects versions with alternation (116ms)
  ✓ top level patterns should match after install (62ms)
  ✓ warns for missing bundledDependencies (830ms)
  ✓ install will not overwrite linked scoped dependencies (298ms)
  ✓ install will not overwrite linked dependencies (171ms)
  ✓ file: dependency ending with `.git` should work (49ms)
  ✓ install will not warn for missing peerDep when both shallower and deeper (2365ms)
  ○ skipped 1 test

 PASS  __tests__/commands/install/offline-mirror.js (10.666s)
  ✓ install with offline mirror and pack-built-packages setting should run install scripts on first call and not run on second while producing the same node_modules (3556ms)
  ✓ install with offline mirror and pack-built-packages setting should not ignore ".npmignore" (27ms)
  ✓ install without pack-built-packages should keep running install scripts (1ms)
  ✓ removing prebuilt package .tgz file falls back to running scripts (8ms)
  ✓ switching platform for installed node_modules should trigger rebuild / using another prebuilt tgz (435ms)
  ✓ creates the file in the mirror when fetching a git repository (5462ms)
  ✓ install from offline mirror
  ✓ install should add missing deps to yarn and mirror (PR import scenario) (1ms)
  ✓ install should update a dependency to yarn and mirror (PR import scenario 2)
  ✓ offline mirror can be enabled from parent dir
  ✓ offline mirror can be enabled from parent dir, with merging of own .yarnrc
  ✓ offline mirror can be disabled locally
  ✓ prunes the offline mirror tarballs after pruning is enabled (1ms)
  ✓ scoped packages remain in offline mirror after pruning is enabled

 PASS  __tests__/commands/add.js (122.972s)
  ✓ add without --ignore-workspace-root-check should fail on the workspace root (16365ms)
  ✓ add with --ignore-workspace-root-check shouldn't fail on the workspace root (7839ms)
  ✓ adding to the workspace root should preserve workspace packages in lockfile (2816ms)
  ✓ adds any new package to the current workspace, but install from the workspace (5441ms)
  ✓ add creates an entry with a sha512 integrity field
  ✓ add creates an entry with a sha1 integrity field when sha512 is unavailable (1ms)
  ✓ install with arg (2488ms)
  ✓ install from github
  ✓ install from github with invalid version should fail (1ms)
  ✓ install with --dev flag
  ✓ install with --peer flag
  ✓ install with --optional flag
  ✓ install with --tilde flag
  ✓ warns when adding a devDependency as dependency
  ✓ doesn't warn when adding a devDependency as devDependency
  ✓ warns when adding a dependency as devDependency
  ✓ doesn't warn when adding a dependency as dependency
  ✓ install with link: specifier
  ✓ install with arg that has binaries (5803ms)
  ✓ add with no manifest creates blank manifest (34915ms)
  ✓ add should ignore cache
  ✓ add should not make package.json strict
  ✓ add --save-exact should not make all package.json strict
  ✓ add save-prefix should not expand ~ to home dir
  ✓ add save-exact should make all package.json strict
  ✓ add with new dependency should be deterministic 3 (41054ms)
  ✓ install --initMirror should add init mirror deps from package.json
  ✓ add with new dependency should be deterministic
  ✓ add with new dependency should be deterministic 2
  ✓ add with offline mirror
  ✓ install with --save and without offline mirror
  ✓ upgrade scenario
  ✓ upgrade scenario 2 (with sub dependencies)
  ✓ install another fork of an existing package
  ✓ downgrade scenario (1ms)
  ✓ modules resolved multiple times should save to mirror correctly
  ✓ Insecure HTTP npmjs tarball URLs should still be normalised to registry.yarnpkg.com
  ✓ add should put a git dependency to mirror
  ✓ add should store latest version in lockfile
  ✓ add should generate correct integrity file
  ✓ add infers line endings from existing win32 manifest file (1ms)
  ✓ add infers line endings from existing unix manifest file
  ✓ install with latest tag
  ✓ install with latest tag and --offline flag
  ✓ install with latest tag and --offline flag scoped
  ✓ install with latest tag and --prefer-offline flag
  ✓ install with latest tag and --prefer-offline flag scoped
  ✓ doesn't warn when peer dependency is met during add (1ms)
  ✓ warns when peer dependency is not met during add
  ✓ warns when peer dependency is incorrect during add
  ✓ should only refer to higher levels to satisfy peer dependency
  ✓ should refer to deeper dependencies to satisfy peer dependency
  ✓ should retain build artifacts after add when missing integrity file
  ✓ should retain build artifacts after add (1ms)
  ✓ should not run scripts if build artifact changed (1025ms)
  ✓ installing with --pure-lockfile and then adding should keep build artifacts (1ms)
  ✓ preserves unaffected bin links after adding to workspace package
  ✓ installs "latest" instead of maxSatisfying if it satisfies requested pattern
  ✓ installs "latest" instead of maxSatisfying if no requested pattern (1ms)
  ○ skipped 2 tests
  nohoist
    ✓ can add nohoist package from workspace (1ms)
    ✓ can add nohoist package from root

 PASS  __tests__/commands/check.js
  ✓ --verify-tree should report wrong version (768ms)
  ✓ --verify-tree should work from a workspace cwd
  ✓ --verify-tree should report missing dependency
  ✓ --verify-tree should pass on hoisted dependency  (56ms)
  ✓ --verify-tree should check dev dependencies 
  ✓ --verify-tree should check skip dev dependencies if --production flag passed
  ✓ --verify-tree should check skip deeper dev dependencies
  ✓ --integrity should ignore comments and whitespaces in yarn.lock (669ms)
  ✓ --integrity should fail if integrity file is missing
  ✓ --integrity should fail if integrity file is not a json
  ✓ --integrity should fail if yarn.lock has patterns changed
  ✓ --integrity should fail if yarn.lock has new pattern (1ms)
  ✓ --integrity should fail if yarn.lock has resolved changed
  ✓ --integrity should fail if files are missing and --check-files is passed (36ms)
  ✓ --integrity should fail if --ignore-scripts is changed
  ✓ when switching to --check-files install should rebuild integrity file (67ms)
  ✓ --integrity should fail if integrity file have different linkedModules
  ✓ --integrity should fail if integrity file has different systemParams (1ms)
  ✓ --integrity should create the integrity file under the meta folder if enabled
  ✓ --check-files should register the right entries even when using the meta folder
  ✓ --integrity --check-files should not die on broken symlinks (153ms)
  ✓ --integrity should not die on missing fields in integrity file
  ✓ should ignore bundled dependencies
  ✓ should warn about mismatched dependencies if they match resolutions (simple) (1ms)
  ✓ should warn about mismatched dependencies if they match resolutions (tree)
  ✓ should warn about mismatched dependencies if they match resolutions (glob)
  ✓ --integrity should throw an error if top level patterns do not match

 PASS  __tests__/commands/install/lockfiles.js (16.814s)
  ✓ does fetch files from the local filesystem (8260ms)
  ✓ doesn't write new lockfile if existing one satisfied
  ✓ writes new lockfile if existing one isn't satisfied (32ms)
  ✓ writes a lockfile when there are no dependencies
  ✓ throws an error if existing lockfile isn't satisfied with --frozen-lockfile
  ✓ doesn't write new lockfile if existing one satisfied but not fully optimized with --frozen-lockfile (282ms)
  ✓ install transitive optional dependency from lockfile (7676ms)
  ✓ root install from shrinkwrap
  ✓ install have a clean node_modules after lockfile update (branch switch scenario)
  ✓ install have a clean node_modules after lockfile update (branch switch scenario 2)
  ✓ install should write and read integrity file based on lockfile entries
  ✓ install should retain artifacts when missing integrity file
  ✓ install should not continue if integrity check passes (1ms)
  ✓ install should not rewrite lockfile with no substantial changes
  ✓ lockfile should be created when missing even if integrity matches
  ✓ install infers line endings from existing win32 lockfile
  ✓ install infers line endings from existing unix lockfile
  ✓ install uses OS line endings when lockfile doesn't exist
  ✓ install should rewrite lockfile if patterns can be merged
  ✓ install should fix if lockfile patterns don't match resolved version
  ✓ install should warn if a conflicting npm package-lock.json exists (1ms)
  ✓ install should warn if a conflicting npm npm-shrinkwrap.json exists

 PASS  __tests__/index.js (13.636s)
  ✓ should add package (6665ms)
  ✓ should add package with no-lockfile option (1838ms)
  ✓ should add package with frozen-lockfile option (1780ms)
  ✓ should add package with no-lockfile option in front (1262ms)
  ✓ should add lockfile package (1175ms)
  ✓ should add progress package globally
  ✓ should run custom script
  ✓ should run custom script without run command
  ✓ should run help command
  ✓ should run help command with --help (1ms)
  ✓ should run help command with -h
  ✓ should run add command with help option
  ✓ should run add command with h option
  ✓ should run help command with add option
  ✓ should run --help command with add option
  ✓ should run -h command with add option
  ✓ should show version of yarn with -v (1ms)
  ✓ should run version command
  ✓ should run --version command
  ✓ should exit cleanly when running invalid commands
  ✓ should install if no args
  ✓ should install if first arg looks like a flag
  ✓ should not output JSON activity/progress if given --no-progress option
  ✓ should run help of run command if --help is before script (1ms)
  ✓ should run help of custom-script if --help is after script
  ✓ should run bin command
  ✓ should throws missing command for not camelised command
  ✓ should throws missing command for not alphabetic command
  ✓ should throws missing command for unknown command
  ✓ should not display documentation link for unknown command
  ✓ should display documentation link for known command
  ✓ should throws missing command for constructor command (1ms)
  ✓ should run command with hyphens
  ✓ should run camelised command for command with hyphens
  ✓ should run help for command with hyphens
  ✓ should run help for camelised command
  ✓ should not pass yarnrc flags to workspace command

 PASS  __tests__/commands/install/integration-deduping.js (60.986s)
  ✓ install should dedupe dependencies avoiding conflicts 0 (5564ms)
  ✓ install should dedupe dependencies avoiding conflicts 1
  ✓ install should dedupe dependencies avoiding conflicts 2 (1851ms)
  ✓ install should dedupe dependencies avoiding conflicts 3
  ✓ install should dedupe dependencies avoiding conflicts 4
  ✓ install should dedupe dependencies avoiding conflicts 5
  ✓ install should dedupe dependencies avoiding conflicts 6 (jest/jest-runtime case)
  ✓ install should dedupe dependencies avoiding conflicts 7 (1807ms)
  ✓ install should dedupe dependencies avoiding conflicts 8 (51326ms)
  ✓ install should dedupe dependencies avoiding conflicts 9
  hardlink
    ✓ install should hardlink repeated dependencies
    ✓ install should not hardlink repeated dependencies if linkDuplicates=false (1ms)
    ✓ install should not crash when hardlinking deep structures
    ✓ install should consider different hoisting with --link-duplicate (2ms)
    ✓ install should consider different hoisting with --link-duplicate 2 (1ms)
    ✓ install should not hardlink full package structure
    in workspaces
      ✓ no hardlink for workspace references and linked dependencies
      ✓ should work with nohoist

 PASS  __tests__/fetchers.js
  ✓ BaseFetcher.fetch (160ms)
  ✓ CopyFetcher.fetch (26ms)
  ✓ GitFetcher.fetch (646ms)
  ✓ GitFetcher.getTarballMirrorPath without slashes in the repo path (11ms)
  ✓ GitFetcher.fetch with prepare script (2513ms)
  ✓ TarballFetcher.fetch (106ms)
  ✓ TarballFetcher.fetch throws on invalid hash (14ms)
  ✓ TarballFetcher.fetch fixes hash if updateChecksums flag is true (43ms)
  ✓ TarballFetcher.fetch throws on invalid integrity (9ms)
  ✓ TarballFetcher.fetch supports local ungzipped tarball (33ms)
  ✓ TarballFetcher.fetch properly stores tarball of package in offline mirror (20ms)
  ✓ TarballFetcher.fetch properly stores tarball of scoped package in offline mirror (20ms)
  ✓ TarballFetcher.fetch properly stores tarball for scoped package resolved from artifactory registry (10ms)
  ✓ TarballFetcher.fetch properly stores tarball for scoped package resolved from new  style URLs (11ms)
  ✓ TarballFetcher.fetch throws on truncated tar data (18ms)
  ✓ TarballFetcher.fetch throws on truncated tar header (29ms)

 PASS  __tests__/util/request-manager.js
  ✓ RequestManager.request with cafile (204ms)
  ✓ RequestManager.request with ca (string) (36ms)
  ✓ RequestManager.request with ca (array) (40ms)
  ✓ RequestManager.request with mutual TLS (56ms)
  ✓ RequestManager.execute timeout error with maxRetryAttempts=1 (76ms)
  ✓ RequestManager.execute timeout error with default maxRetryAttempts (293ms)
  ✓ RequestManager.execute Request 403 error (17ms)
  ✓ RequestManager.execute Request 442 error (17ms)
  ✓ RequestManager.execute one time password error on npm request (32ms)
  ✓ RequestManager.execute one time password error on npm login request (12ms)
  ✓ RequestManager.execute retries on 408 error (18ms)
  ✓ RequestManager.execute retries on 500 error (14ms)
  ✓ RequestManager.execute retries on 542 error (11ms)
  ✓ RequestManager.request with offlineNoRequests (13ms)
  ✓ RequestManager.saveHar no captureHar error message (12ms)

 PASS  __tests__/commands/install/focus.js (5.236s)
  ✓ focus does not work from a non-workspaces project (437ms)
  ✓ focus does not work from the root of a workspaces project (60ms)
  ✓ focus does a normal workspace installation (4110ms)
  ✓ focus shallowly installs sibling workspaces under target (1ms)
  ✓ focus should not bail out early after an un-focused install (349ms)
  ✓ repeated focused installs should bail out early
  ✓ switching directories for focused installs should fail integrity checks and reinstall (1ms)
  ✓ focus shallowly installs anything that a sibling needed to shallowly install underneath that sibling
  ✓ focus does not shallowly install a sibling's dev dependencies (1ms)
  ✓ focus runs shallow dependencies' postinstall scripts
  ✓ focus installs transitive dependencies shallowly
  ✓ focus does not install transitive devdependencies shallowly (but does install non-transitive devdeps)
  ✓ focus does not shallowly install current version of sibling if another version is specified in package.json
  ✓ focus works correctly when focusing on a scoped package
  nohoist
    ✓ focus installs nohoist dependencies shallowly
    ✓ focus does not do nested shallow installs of transitive nohoist packages
    ✓ focus installs the correct version when a package is nohoist but differs from the workspace version

 PASS  __tests__/commands/remove.js
  ✓ throws error with no arguments (914ms)
  ✓ throws error when package is not found
  ✓ remove without --ignore-workspace-root-check should fail on the workspace root (414ms)
  ✓ remove with --ignore-workspace-root-check shouldn't fail on the workspace root (159ms)
  ✓ removes package installed from npm registry
  ✓ removes multiple installed packages (1ms)
  ✓ removes the whole scope when all scoped packages are removed
  ✓ removes a single scoped package
  ✓ removes subdependencies (338ms)
  ✓ can prune the offline mirror
  ✓ removes package installed without a manifest (1ms)
  ✓ removes from workspace packages
  ✓ preserves unaffected bin links after removing workspace packages (453ms)

 PASS  __tests__/util/git.js
  ✓ npmUrlToGitUrl (8ms)
  ✓ secureGitUrl (4ms)
  ✓ resolveDefaultBranch when local (193ms)
  ✓ resolveDefaultBranch when remote (12ms)
  ✓ resolveCommit (12ms)
  secureGitUrl()
    ✓ accepts URLs with commit hash (5ms)
    ✓ accepts URLs without commit hash over secure protocols (2ms)
    ✓ changes insecure URLs to HTTPS (2ms)
    ✓ warns if insecure URLs cannot be changed to HTTPS (3ms)

 PASS  __tests__/commands/why.js
  ✓ throws error with no arguments (540ms)
  ✓ throws error with too many arguments (1ms)
  ✓ doesn't throw when using it inside a workspace (858ms)
  ✓ throws error if module does not exist (266ms)
  ✓ should determine that the module installed because it is in dependencies (27ms)
  ✓ should determine that the module installed because it is in devDependencies
  ✓ should determine that the module installed because mime-types depend on it
  ✓ should determine that the module installed because it is hoisted from glob depend on it
  ✓ should report when a module is included multiple times including the root (58ms)
  reports multiple occurrences
    ✓ due to nohoist
    ✓ due to version conflict
  queryWhy
    ✓ can determine a nohoist module (2ms)
    ✓ can determine a deep nohoist module (1ms)
    ✓ can return multiple matches

 PASS  __tests__/commands/run.js
  ✓ lists all available commands with no arguments (374ms)
  ✓ lists all available commands with no arguments and --non-interactive (19ms)
  ✓ runs script containing spaces (24ms)
  ✓ properly handles extra arguments and pre/post scripts (21ms)
  ✓ properly handle bin scripts (19ms)
  ✓ properly handle env command (30ms)
  ✓ adds string delimiters if args have spaces (17ms)
  ✓ adds quotes if args have spaces and quotes (19ms)
  ✓ returns noScriptsAvailable with no scripts (24ms)
  ✓ returns noBinAvailable with no bins (20ms)
  ✓ adds workspace root node_modules/.bin to path when in a workspace (24ms)
  ✓ runs script with custom script-shell (19ms)

 PASS  __tests__/integration.js (155.315s)
  ✓ yarn add scrollin (3472ms)
  ✓ yarn add https://git@github.com/stevemao/left-pad.git (51ms)
  ✓ yarn add https://github.com/bestander/chrome-app-livereload.git (1078ms)
  ✓ yarn add bestander/chrome-app-livereload (1ms)
  ✓ yarn add https://github.com/yarnpkg/yarn/releases/download/v0.18.1/yarn-v0.18.1.tar.gz (41779ms)
  ✓ yarn add react-scripts@1.0.13 (43047ms)
  ✓ --mutex network (28737ms)
  ✓ --mutex network with busy port (649ms)
  ✓ --cwd option (1414ms)
  ✓ default rc (1187ms)
  ✓ --no-default-rc (844ms)
  ✓ --use-yarnrc (747ms)
  ✓ yarnrc arguments (1200ms)
  ✓ yarn run <script> --opt (954ms)
  ✓ yarn run <script> -- --opt (795ms)
  ✓ yarn run <script> <strings that need escaping> (894ms)
  ✓ yarn run <failing script> (847ms)
  ✓ yarn run in path need escaping (697ms)
  ✓ cache folder fallback (1064ms)
  ✓ relative cache folder (672ms)
  ✓ yarn create (2115ms)
  ✓ yarn init -y (636ms)
  production
    ✓ it should be true when NODE_ENV=production (683ms)
    ✓ it should default to false (625ms)
    ✓ it should prefer CLI over NODE_ENV (705ms)
    ✓ it should prefer YARN_PRODUCTION over NODE_ENV (671ms)
    ✓ it should prefer CLI over YARN_PRODUCTION (626ms)
  --registry option
    ✓ --registry option with npm registry (1394ms)
    ✓ --registry option with yarn registry (1211ms)
    ✓ --registry option with non-exiting registry and show an error (13303ms)
    ✓ registry option from yarnrc (1329ms)
  yarnrc path
    ✓ js file (391ms)
    ✓ executable file (258ms)
    ✓ js file exit code (342ms)
    ✓ sh file exit code (247ms)

 PASS  __tests__/commands/import.js
  ✓ import shallow deps (2834ms)
  ✓ import deep deps (1ms)
  ✓ import shallow dev deps
  ✓ import github deps
  ✓ import file deps
  ✓ import overlapping semver ranges successfully
  ✓ throw on missing dev deps
  ✓ including Yarn and Node version in yarn.lock
  ✓ import missing dev deps in production (39ms)
  ✓ import missing opt deps
  ✓ throw when yarn.lock exists
  ✓ import shallow deps from package-lock.json
  ✓ import deep deps from package-lock.json (1ms)
  ✓ import shallow dev deps from package-lock.json
  ✓ import github deps from package-lock.json
  ✓ import file deps from package-lock.json
  ✓ import overlapping semver ranges from package-lock.json successfully
  ✓ throw on corrupted package-lock.json
  ✓ throw on corrupted package-lock.json - missing dependencies (package-lock.json inconsistent)
  ✓ import uncorrupted (consistent) package-lock.json with missing dependencies (1ms)
  ✓ including Yarn and Node version in yarn.lock from package-lock.json

 PASS  __tests__/lockfile.js
  ✓ parse/stringify 1 (5ms)
  ✓ parse/stringify 2 (1ms)
  ✓ parse/stringify 3
  ✓ parse/stringify 4 (2ms)
  ✓ parse (4ms)
  ✓ stringify (1ms)
  ✓ Lockfile.fromDirectory
  ✓ Lockfile.getLocked (1ms)
  ✓ Lockfile.getLocked pointer
  ✓ Lockfile.getLocked no cache (1ms)
  ✓ Lockfile.getLocked defaults (1ms)
  ✓ Lockfile.getLocked unknown
  ✓ Lockfile.getLockfile (1ms)
  ✓ Lockfile.getLockfile (sorting) (1ms)
  ✓ Lockfile.getLockfile handles integrity field (1ms)
  ✓ parse single merge conflict (2ms)
  ✓ parse single merge conflict with CRLF (1ms)
  ✓ parse multiple merge conflicts (1ms)
  ✓ parse merge conflict fail (1ms)
  ✓ discards common ancestors in merge conflicts (1ms)

 PASS  __tests__/commands/pack.js
  ✓ pack should work with a minimal example (585ms)
  ✓ pack should include all files listed in the files array (31ms)
  ✓ pack should include files based from the package’s root
  ✓ pack should included globbed files (1ms)
  ✓ pack should include mandatory files not listed in files array if files not empty (14ms)
  ✓ pack should exclude mandatory files from ignored directories
  ✓ pack should include files only ignored in other directories (5ms)
  ✓ pack should exclude all other files if files array is not empty
  ✓ pack should exclude all dotfiles if not in files and files not empty
  ✓ pack should exclude all files in dot-directories if not in files and files not empty
  ✓ pack should include bundled dependencies (3ms)
  ✓ pack should match dotfiles with globs

 PASS  __tests__/commands/list.js
  list
    ✓ throws if lockfile out of date (470ms)
    ✓ lists everything with no args
    ✓ respects depth flag
    ✓ accepts an argument
    ✓ accepts a pattern
    ✓ should not throw when list is called with resolutions field (2ms)
    ✓ respects depth flag (1ms)
    ✓ matches exactly without glob in argument
    ✓ expands a glob in argument
    ✓ expands a glob in pattern
    ✓ lists all dependencies when not production (23ms)
    ✓ does not list devDependencies when production (22ms)
    ✓ does not error listing dependencies when production and no devDependencies exist (18ms)
    ✓ getParent should extract a parent object from a hash, if the parent key exists (1ms)
    ✓ getParent should return undefined if the key does not exist in hash
    ✓ getReqDepth should return a number if valid (1ms)
    ✓ getReqDepth should return -1 if invalid (1ms)

 PASS  __tests__/commands/install/resolutions.js
  ✓ install with simple exact resolutions should override all versions (1873ms)
  ✓ install with subtree exact resolutions should override subtree versions
  ✓ install with --frozen-lockfile with resolutions
  ✓ install with exotic resolutions should override versions (362ms)
  ✓ install with range resolutions should override versions (1ms)
  ✓ should warn when resolution entries are incorrrect or incompatible
  ✓ install with resolutions should correctly install simple scoped packages
  ✓ install with resolutions should correctly install toplevel scoped packages (1ms)
  ✓ install with nested resolutions
  ✓ install with nested resolutions using flat mode
  ✓ install with resolution settings should correctly bailout during the integrity check
  ✓ adding resolutions after install should cause lockfile regeneration on second install (1ms)

 PASS  __tests__/reporters/console-reporter.js
  ✓ ConsoleReporter.step (8ms)
  ✓ ConsoleReporter.header (49ms)
  ✓ ConsoleReporter.footer (2ms)
  ✓ ConsoleReporter.log (1ms)
  ✓ ConsoleReporter.success (1ms)
  ✓ ConsoleReporter.error (1ms)
  ✓ ConsoleReporter.info (1ms)
  ✓ ConsoleReporter.command (1ms)
  ✓ ConsoleReporter.warn (1ms)
  ✓ ConsoleReporter.tree (3ms)
  ✓ ConsoleReporter.activity (53ms)
  ✓ ConsoleReporter.select (9ms)
  ✓ ConsoleReporter.progress (51ms)
  ✓ ProgressBar (1ms)
  ✓ Spinner (2ms)
  ✓ close (2ms)
  ✓ ConsoleReporter.log is silent when isSilent is true
  ✓ ConsoleReporter.tree is silent when isSilent is true (1ms)
  ✓ ConsoleReporter.auditSummary (2ms)

 PASS  __tests__/config.js
  ✓ getOption changes ~ to cwd when resolve=true (82ms)
  ✓ getOption does not change ~ when resolve=false (11ms)
  ✓ getOption does not change empty-string when resolve=true (10ms)
  ✓ getOption does not change empty-string when resolve=false (9ms)
  workspaces config
    ✓ accessing workspaces config requires explicit enabling (11ms)
    ✓ can adapt legacy workspaces to new format (1ms)
    ✓ workspaces is eligible only for private packages (9ms)
    ✓ nohoist is eligible only for private packages and workspacesNohoistEnabled (10ms)
    ✓ can throw exception for eligibility violation (11ms)
    ✓ can report eligibility warnings (14ms)

 PASS  __tests__/commands/global.js (17.722s)
  ✓ add without flag (10561ms)
  ✓ add with prefix flag (1ms)
  ✓ add with PREFIX enviroment variable (6343ms)
  ✓ shouldn't expose unwanted binaries
  ✓ bin
  ✓ add
  ✓ add (with scoped registry)
  ✓ remove (1ms)
  ✓ ls
  ✓ list
  ✓ upgrade (566ms)
  ✓ symlink update

 PASS  __tests__/commands/version.js
  ✓ run version with no arguments and --new-version flag (422ms)
  ✓ run version with no arguments, --new-version flag where version is same as pkg.version (16ms)
  ✓ run version with --non-interactive and --new-version should succeed (15ms)
  ✓ run version with --non-interactive and without --new-version should succeed (15ms)
  ✓ run version and make sure all lifecycle steps are executed (17ms)
  ✓ run version and make sure only the defined lifecycle steps are executed (18ms)
  ✓ run version and make sure git commit hooks are enabled by default (27ms)
  ✓ run version with --no-commit-hooks and make sure git commit hooks are disabled (17ms)
  ✓ run version and make sure commit hooks are disabled by config (20ms)
  ✓ run version with --major flag and make sure major version is incremented (16ms)
  ✓ run version with --minor flag and make sure minor version is incremented (15ms)
  ✓ run version with --patch flag and make sure patch version is incremented (18ms)

 PASS  __tests__/util/git/git-ref-resolver.js
  ✓ resolveVersion (113ms)
  ✓ isCommitSha (1ms)
  ✓ parseRefs (2ms)

 PASS  __tests__/commands/outdated.js
  ✓ throws if lockfile is out of date (696ms)
  ✓ no output when current matches latest (9ms)
  ✓ works with no arguments
  ✓ works with single argument (1ms)
  ✓ works with multiple arguments
  ✓ works with exotic resolvers
  ✓ hides when current > latest (next, beta tag) (2ms)
  ✓ shows when wanted > current and current > latest (31ms)
  ✓ displays correct dependency types
  ✓ shows dependencies from entire workspace (30ms)

 PASS  __tests__/commands/init.js
  ✓ init should create package.json on current cwd (42ms)
  ✓ init --yes should create package.json with defaults (19ms)
  ✓ init --yes --private should create package.json with defaults and private true (17ms)
  ✓ init should use init-* configs when defined (14ms)
  ✓ init using Github shorthand should resolve to full repository URL (16ms)
  ✓ init and give private empty (43ms)
  ✓ getGitConfigInfo should not return the git config val
  ✓ getGitConfigInfo should not fail when git fails (1ms)

 PASS  __tests__/lifecycle-scripts.js (7.709s)
  ✓ should add the global yarnrc arguments to the command line (2399ms)
  ✓ should add the command-specific yarnrc arguments to the command line if the command name matches
  ✓ should not add the command-specific yarnrc arguments if the command name doesn't match (237ms)
  ✓ should allow overriding the yarnrc values from the command line
  ✓ should resolve the yarnrc values relative to where the file lives
  ✓ should expose `npm_config_argv` env variable to lifecycle scripts for back compatibility with npm (1759ms)
  ✓ should not run pre/post hooks for .bin executables
  ✓ should not run pre/post hooks if they are .bin executables and not scripts
  ✓ should only expose non-internal configs (1ms)
  ✓ should run both prepublish and prepare when installing, but not prepublishOnly
  ✓ should run both prepack and postpack
  ✓ should allow setting environment variables via yarnrc
  ✓ should inherit existing environment variables when setting via yarnrc (1ms)
  ✓ should not show any error messages when script ends successfully (959ms)
  ✓ should throw error when the script ends with an exit code (923ms)
  ✓ should throw error when the script ends with an exit signal (1113ms)

 PASS  __tests__/util/semver.js
  satisfiesWithPrereleases
    ✓ matches the behavior of node-semver for non-prerelease versions (11ms)
    ✓ matches inexact prerelease versions (5ms)
    ✓ rejects prerelease versions that are too small (2ms)
    ✓ rejects prerelease versions that are too big (2ms)
    ✓ rejects prerelease versions that are invalid
    ✓ follows the semver spec when comparing prerelease versions (4ms)
  diffWithUnstable
    ✓ matches the behavior of node-semver for stable versions (4ms)
    ✓ treats patch and minor releases for pre-major versions as minor & major respectively (2ms)
    ✓ treats patch and minor releases for pre-minor versions as major (17ms)
    ✓ returns null for equal versions (2ms)

 PASS  __tests__/commands/info.js
  ✓ without arguments and in directory containing a valid package file (804ms)
  ✓ with first argument "." and in directory containing a valid package file (29ms)
  ✓ with one argument shows info about the package with specified name
  ✓ with one argument does not contain readme field
  ✓ with two arguments and second argument "readme" shows readme string
  ✓ with two arguments and second argument "version" shows `latest` version
  ✓ with two arguments and second argument as a simple field
  ✓ with two arguments and second argument as "."-separated field path (12ms)
  ✓ with two arguments and second argument as a non-existing field (1ms)
  ✓ with two arguments and second argument path containing non-existing field
  ✓ reports error on invalid package names (60ms)
  ✓ reports error with too many arguments

 PASS  __tests__/commands/cache.js
  ✓ list (320ms)
  ✓ list skips corrupted package (64ms)
  ✓ ls with scoped packages (235ms)
  ✓ ls with filter that matches cache (199ms)
  ✓ ls with filter that matches cache with wildcard (223ms)
  ✓ ls with multiple patterns, one matching (185ms)
  ✓ ls with pattern that only partially matches (237ms)
  ✓ ls with filter that does not match (258ms)
  ✓ ls filter by pattern with scoped package (152ms)
  ✓ dir (46ms)
  ✓ clean (215ms)
  ✓ clean with package name (193ms)
  ✓ clean with multiple package names (106ms)

running the prepublish hook
 PASS  __tests__/normalize-manifest.js
  ✓ author object normalize (138ms)
  ✓ author string (28ms)
  ✓ authors file to contributors (19ms)
  ✓ bin string (20ms)
  ✓ binding.gyp scripts.install (13ms)
  ✓ bugs string (17ms)
  ✓ bundledDependencies alias (15ms)
  ✓ clean version (16ms)
  ✓ clean version with v (19ms)
  ✓ contributors array expand (15ms)
  ✓ dedupe all trivial dependencies (19ms)
  ✓ dedupe dependencies (13ms)
  ✓ dedupe dependencies root (14ms)
  ✓ dedupe optionalDependencies (13ms)
  ✓ dedupe optionalDependencies root (13ms)
  ✓ dedupe single trivial dependency (13ms)
  ✓ empty bin string (21ms)
  ✓ engines array (15ms)
  ✓ explode directories.bin (19ms)
  ✓ explode directories.man (16ms)
  ✓ extract description (14ms)
  ✓ homepage string (14ms)
  ✓ hosted git repository url (24ms)
  ✓ keywords string (14ms)
  ✓ maintainers array expand (14ms)
  ✓ man string (16ms)
  ✓ name (13ms)
  ✓ readme (12ms)
  ✓ repository string (15ms)
  ✓ scoped bin string (14ms)
  ✓ server scripts.start (15ms)
  ✓ throw name blacklist (13ms)
  ✓ throw name illegal character (14ms)
  ✓ throw name non-string (16ms)
  ✓ throw name start dot (14ms)
  ✓ throw name url encode required (12ms)
  ✓ valid license (14ms)
  ✓ version (15ms)
  ✓ warn builtin module collision (13ms)
  ✓ warn empty string invalid license (13ms)
  ✓ warn invalid license (17ms)
  ✓ warn typo (17ms)
  ✓ license warnings should not be thrown with global commands (12ms)
  ✓ util.stringifyPerson (1ms)
  ✓ util.parsePerson (1ms)
  ✓ util.extractDescription
  ✓ util.extractRepositoryUrl (1ms)

running the prepare hook
running the prepublishOnly hook
running the prepack hook
running the postpack hook
running the publish hook
running the postpublish hook
 PASS  __tests__/commands/publish.js
  ✓ publish should default access to undefined (794ms)
  ✓ publish should accept `--access restricted` argument
  ✓ publish should accept `--access public` argument
  ✓ publish should use publishConfig.access in package manifest
  ✓ publish should allow `--access` to override publishConfig.access (1ms)
  ✓ publish should run lifecycle scripts in the correct order (55ms)
  ✓ can specify a path
  ✓ can specify a path without `--new-version`
  ✓ publish should respect publishConfig.registry  (1ms)
  ✓ publish with publishConfig.registry and --registry

 PASS  __tests__/util/execute-lifecycle-script.js
  makeEnv
    ✓ assigns npm_lifecycle_event to env (136ms)
    ✓ assigns NODE_ENV production (13ms)
    ✓ assigns INIT_CWD to env (11ms)
    npm_package_*
      ✓ assigns npm_lifecycle_script if manifest has a matching script (12ms)
      ✓ does not overwrite npm_lifecycle_script if manifest does not have a matching script (13ms)
      ✓ recursively adds keys separated by _ (12ms)
      ✓ replaces invalid chars with _ (11ms)
      ✓ it omits certain fields which tend to be too large (17ms)
    npm_package_config_*
      ✓ overwrites npm_package_config_* keys from yarn config or npm config (13ms)
      ✓ does not overwrite if the name does not match the manifest (10ms)

 PASS  __tests__/reporters/json-reporter.js
  ✓ JSONReporter.step (6ms)
  ✓ JSONReporter.footer (1ms)
  ✓ JSONReporter.log (1ms)
  ✓ JSONReporter.command (1ms)
  ✓ JSONReporter.success (1ms)
  ✓ JSONReporter.error
  ✓ JSONReporter.warn (1ms)
  ✓ JSONReporter.info (1ms)
  ✓ JSONReporter.activity (3ms)
  ✓ JSONReporter.progress (3ms)
  ✓ JSONReporter.auditAction (1ms)
  ✓ JSONReporter.auditAdvisory (1ms)
  ✓ JSONReporter.auditSummary (1ms)

 PASS  __tests__/resolvers/exotics/bitbucket-resolver.js
  ✓ hostname should be "bitbucket.org"  (2ms)
  ✓ protocol should be "bitbucket" 
  ✓ explodeHostedGitFragment should work for colon separator after host (1ms)
  ✓ explodeHostedGitFragment should work for colon separator after host and with protocol before
  ✓ explodeHostedGitFragment should work for slash separator after host (1ms)
  ✓ explodeHostedGitFragment should work for package name and colon separator after host (1ms)
  ✓ getTarballUrl should return the correct bitbucket tarball url
  ✓ getGitHTTPBaseUrl should return the correct git bitbucket base url (1ms)
  ✓ getGitHTTPUrl should append ".git" to the HTTP base URL
  ✓ getGitHTTPUrl should return the correct git bitbucket SSH url (1ms)
  ✓ getHTTPFileUrl should return the correct HTTP file url
  ✓ getGitSSHUrl should return URL containing protocol (11ms)

 PASS  __tests__/commands/audit.js
  ✓ sends correct dependency map to audit api for single dependency. (281ms)
  ✓ calls reporter auditAdvisory with correct data (44ms)
  ✓ calls reporter auditSummary with correct data (100ms)

 PASS  __tests__/util/user-dirs.js
  getDataDir
    on windows
      ✓ uses Yarn/data within LOCALAPPDATA if it exists (5ms)
      ✓ uses the config dir otherwise (1ms)
    on linux/darwin
      ✓ uses XDG_DATA_HOME if it is set (1ms)
      ✓ falls back to the config dir
  getCacheDir
    on windows
      ✓ uses Yarn\Cache within LOCALAPPDATA if it exists (1ms)
      ✓ uses AppData\Local\Cache otherwise (1ms)
    on darwin (macOS)
      ✓ uses XDG_CACHE_HOME if it is set (22ms)
      ✓ falls back to Library/Caches/Yarn (2ms)
    on others (linux, etc)
      ✓ uses XDG_CACHE_HOME if it is set (28ms)
      ✓ falls back to .cache/yarn (1ms)
  getConfigDir
    on windows
      ✓ uses Yarn\Config within LOCALAPPDATA if it exists
      ✓ uses the config dir otherwise (1ms)
    on linux/darwin
      ✓ uses XDG_CONFIG_HOME if it is set
      ✓ falls back to .config/yarn (1ms)

 PASS  __tests__/reporters/base-reporter.js
  ✓ BaseReporter.getTotalTime (3ms)
  ✓ BaseReporter.step
  ✓ BaseReporter.error
  ✓ BaseReporter.warn (1ms)
  ✓ BaseReporter.info
  ✓ BaseReporter.success
  ✓ BaseReporter.log
  ✓ BaseReporter.command
  ✓ BaseReporter.header
  ✓ BaseReporter.footer (1ms)
  ✓ BaseReporter.activity
  ✓ BaseReporter.question (1ms)
  ✓ BaseReporter.select
  ✓ BaseReporter.progress (1ms)
  ✓ BaseReporter.disableProgress (1ms)
  ✓ BaseReporter.termstrings (2ms)
  ✓ BaseReporter.prompt (3ms)
  ✓ stringifyLangArgs should replace \n and \r\n with new line (1ms)
  ✓ stringifyLangArgs should not replace \\n with new line

 PASS  __tests__/util/filter.js
  ✓ ignoreLinesToRegex (32ms)
  ✓ filterOverridenGitignores (1ms)

  console.warn __tests__/__mocks__/request.js:97
    No request cache for https://raw.githubusercontent.com/bestander/chrome-app-livereload/e7539a7c82858db89069b9276befcff807a4caee/package.json

 PASS  __tests__/resolvers/index.js
  ✓ getExoticResolver does not return a Resolver for 0.0.0 pattern (102ms)
  ✓ getExoticResolver returns NPM Registry Resolver for npm:0.0.0 pattern (2ms)
  ✓ getExoticResolver returns Yarn Registry Resolver for yarn:0.0.0 pattern (1ms)
  ✓ getExoticResolver returns Git Resolver for git+ssh://... pattern (1ms)
  ✓ getExoticResolver returns Git Resolver for git+https://... pattern
  ✓ getExoticResolver returns Git Resolver for git+file:///... pattern (1ms)
  ✓ getExoticResolver returns Git Resolver for git://... pattern (1ms)
  ✓ getExoticResolver returns Git Resolver for ssh://... pattern
  ✓ getExoticResolver returns Git Resolver for http://... pattern with .git extension
  ✓ getExoticResolver returns Git Resolver for https://... pattern with .git extension
  ✓ getExoticResolver returns Tarball Resolver for http://... pattern (1ms)
  ✓ getExoticResolver returns Tarball Resolver for https://... pattern
  ✓ getExoticResolver returns Gist Resolver for gist://... pattern (1ms)

  console.warn __tests__/__mocks__/request.js:97
    No request cache for https://raw.githubusercontent.com/bestander/chrome-app-livereload/e7539a7c82858db89069b9276befcff807a4caee/yarn.json

 PASS  __tests__/commands/autoclean.js
  ✓ tells user to run with --init when .yarnclean does not exist (550ms)
  ✓ tells user to run with --init when .yarnclean does not exist and --force (1ms)
  ✓ tells user to edit .yarnclean after init (1ms)
  ✓ creates .yarnclean when --init passed (3ms)
  ✓ tells user to run with --force when .yarnclean exists
  ✓ tells user file exists already when --init and .yarnclean exists (1ms)
  ✓ runs clean when --force passed and .yarnclean exists (24ms)
  ✓ runs clean even through workspaces (18ms)

 PASS  __tests__/commands/unlink.js
  ✓ creates folder in linkFolder (316ms)
  ✓ throws error if package.json does not have name (1ms)
  ✓ creates cmd file on Windows

 PASS  __tests__/package-request.js
  ✓ Produce valid remote type for a git-over-ssh dep (528ms)
  ✓ Produce valid remote type for a git-over-https dep (21ms)
  ✓ Produce valid remote type for a git public dep (21ms)
  ✓ Check parentNames flowing in the request (26ms)

 PASS  __tests__/resolvers/exotics/git-resolver.js
  ✓ isVersion true for ssh: protocol (6ms)
  ✓ isVersion true for git: protocol (2ms)
  ✓ isVersion true for git+ssh: protocol (1ms)
  ✓ isVersion true for http: protocol when ends with .git
  ✓ isVersion true for http: protocol when ends with .git and hash (1ms)
  ✓ isVersion false for http: protocol when does not end with .git (1ms)
  ✓ isVersion false for http: protocol when does not end with .git with hash
  ✓ isVersion true for https: protocol when ends with .git (1ms)
  ✓ isVersion true for https: protocol when ends with .git and hash
  ✓ isVersion false for https: protocol when does not end with .git (1ms)
  ✓ isVersion false for https: protocol when does not end with .git with hash (1ms)
  ✓ isVersion false for file: protocol when ends with .git
  ✓ isVersion true for any github.com repo url (1ms)
  ✓ isVersion true for any gitlab.com repo url (1ms)
  ✓ isVersion true for any bitbucket.com repo url (1ms)
  ✓ isVersion false for any github url to archive file (1ms)

 PASS  __tests__/commands/create.js
  parsePackageName
    ✓ invalid (76ms)
    ✓ basic (3ms)
    ✓ without name (1ms)
  coerceCreatePackageName
    ✓ invalid (1ms)
    ✓ basic (3ms)
    ✓ not postfixing with "-" if name is emptu (1ms)

 PASS  __tests__/util/git/git-spawn.js
  spawn
    ✓ spawn with default (25ms)
    ✓ spawn with plink (14ms)
    ✓ spawn with custom GIT_SSH (14ms)
    ✓ spawn with custom GIT_SSH_COMMAND (11ms)

 PASS  __tests__/commands/config.js
  ✓ write cache-folder config into .yarnrc file (131ms)
  ✓ cache-folder flag has higher priorities than .yarnrc file (42ms)
  ✓ bin-links flag has higher priorities than .yarnrc file (15ms)
  ✓ set true when option value is undefined (15ms)
  ✓ set empty string to an option (13ms)
  ✓ set value "false" to an option (11ms)
  ✓ set value "true" to an option (12ms)

 PASS  __tests__/commands/workspaces.js
  ✓ workspaces info should list the workspaces (218ms)
  ✓ workspaces run should spawn command for each workspace (15ms)

 PASS  __tests__/commands/workspace.js
  ✓ workspace run command (110ms)
  ✓ workspace run command forwards raw arguments (17ms)

 PASS  __tests__/commands/licenses.js
  ✓ list should show licenses of dependencies (431ms)
  ✓ generate-disclaimer should show license texts of dependencies (46ms)

 PASS  __tests__/rc.js
  ✓ resolve .yarnrc args and use --cwd if present (231ms)
  ✓ don't resolve .yarnrc args from the default locations when using --no-default-rc (1ms)
  ✓ resolve .yarnrc args from the extraneous locations when using --use-yarnrc
  ✓ resolve .yarnrc args and use process.cwd() if no --cwd present (2ms)
  ✓ resolve .yarnrc args and handle --cwd arg inside .yarnrc (2ms)
  ✓ resolve .yarnrc args and bail out of recursive --cwd args inside of .yarnrc (3ms)
  ✓ resolve .yarnrc args and adds command name prefixed arguments (1ms)

 PASS  __tests__/util/fix-cmd-win-slashes.js
  fixCmdWinSlashes
    ✓ fixes just slashed command (54ms)
    ✓ fixes slashed command in double quotes (1ms)
    ✓ slashed command in single quotes
    ✓ fixes slashed command with slashed param (1ms)
    ✓ fixes slashed command in single quotes with two slashed params (1ms)
    ✓ fixes two slashed commands (&&) with two slashed params
    ✓ fixes three slashed commands (&&) with two slashed params (1ms)
    ✓ does not change nested command (inside the quotes) (1ms)

 PASS  __tests__/resolvers/exotics/hosted-git-resolver.js
  ✓ explodeHostedGitFragment jure/lens#fix-issue-#96 -> user: 'jure' (4ms)
  ✓ explodeHostedGitFragment jure/lens#fix-issue-#96 -> repo: 'lens' (1ms)
  ✓ explodeHostedGitFragment jure/lens#fix-issue-#96 -> hash: 'fix-issue-#96'
  ✓ explodeHostedGitFragment jure/lens#feature/fix-issue -> user: 'jure' (1ms)
  ✓ explodeHostedGitFragment jure/lens#feature/fix-issue -> repo: 'lens' (1ms)
  ✓ explodeHostedGitFragment jure/lens#feature/fix-issue -> hash: 'feature/fix-issue'
  ✓ explodeHostedGitFragment jure/lens.github -> user: 'jure'
  ✓ explodeHostedGitFragment jure/lens.github -> repo: 'lens.github' (1ms)
  ✓ explodeHostedGitFragment jure/lens.github -> hash: ''
  ✓ explodeHostedGitFragment jure/lens#semver:^3.0.0 -> user: 'jure' (1ms)
  ✓ explodeHostedGitFragment jure/lens#semver:^3.0.0 -> repo: 'lens'
  ✓ explodeHostedGitFragment jure/lens#semver:^3.0.0 -> hash: 'semver:^3.0.0' (1ms)
  ✓ explodeHostedGitFragment github:jure/lens -> user: 'jure'
  ✓ explodeHostedGitFragment github:jure/lens -> repo: 'lens' (1ms)
  ✓ explodeHostedGitFragment github:jure/lens -> hash: ''
  ✓ explodeHostedGitFragment bitbucket:jure/lens -> user: 'jure' (1ms)
  ✓ explodeHostedGitFragment bitbucket:jure/lens -> repo: 'lens'
  ✓ explodeHostedGitFragment bitbucket:jure/lens -> hash: '' (1ms)
  ✓ explodeHostedGitFragment git+ssh://git@github.com:jure/lens -> user: 'jure'
  ✓ explodeHostedGitFragment git+ssh://git@github.com:jure/lens -> repo: 'lens' (1ms)
  ✓ explodeHostedGitFragment git+ssh://git@github.com:jure/lens -> hash: ''
  ✓ explodeHostedGitFragment git+ssh://git@github.com:jure/lens.git -> user: 'jure' (1ms)
  ✓ explodeHostedGitFragment git+ssh://git@github.com:jure/lens.git -> repo: 'lens'
  ✓ explodeHostedGitFragment git+ssh://git@github.com:jure/lens.git -> hash: '' (1ms)
  ✓ explodeHostedGitFragment git://git@github.com:jure/lens.git -> user: 'jure'
  ✓ explodeHostedGitFragment git://git@github.com:jure/lens.git -> repo: 'lens'
  ✓ explodeHostedGitFragment git://git@github.com:jure/lens.git -> hash: '' (1ms)
  ✓ explodeHostedGitFragment git+https://login@github.com/jure/lens.git -> user: 'jure'
  ✓ explodeHostedGitFragment git+https://login@github.com/jure/lens.git -> repo: 'lens' (1ms)
  ✓ explodeHostedGitFragment git+https://login@github.com/jure/lens.git -> hash: ''
  ✓ explodeHostedGitFragment git+ssh://git@github.com/jure/lens.git#semver:^3.1.0 -> user: 'jure' (1ms)
  ✓ explodeHostedGitFragment git+ssh://git@github.com/jure/lens.git#semver:^3.1.0 -> repo: 'lens' (1ms)
  ✓ explodeHostedGitFragment git+ssh://git@github.com/jure/lens.git#semver:^3.1.0 -> hash: 'semver:^3.1.0'
  ✓ explodeHostedGitFragment git+http://login@github.com/jure/lens.git -> user: 'jure' (1ms)
  ✓ explodeHostedGitFragment git+http://login@github.com/jure/lens.git -> repo: 'lens'
  ✓ explodeHostedGitFragment git+http://login@github.com/jure/lens.git -> hash: ''

 PASS  __tests__/commands/install/integration-hoisting.js
  ✓ install hoister should prioritise popular transitive dependencies (467ms)
  ✓ install hoister should prioritise popular deep dependencies (82ms)
  ✓ install hoister should not install prioritised popular transitive devDependencies in --prod mode

 PASS  __tests__/util/child.js
  ✓ should forward signals to all spawned child processes (6ms)
  ✓ should not attempt to forward signals to children that already terminated (1ms)

 PASS  __tests__/util/fs-normalized.js
  fileDatesEqual
    !win32
      ✓ Same dates equal (27ms)
      ✓ Different dates differ
    win32
      ✓ Same dates equal
      ✓ Different dates differ (1ms)
      ✓ Milliseconds are ignored when one date has zero milliseconds

 PASS  __tests__/resolvers/exotics/gitlab-resolver.js
  ✓ getGitSSHUrl with hash (5ms)
  ✓ getGitSSHUrl with no hash (1ms)
  ✓ getGitHTTPBaseUrl should return the correct git gitlab HTTP base url
  ✓ getGitHTTPUrl should append ".git" to the HTTP base URL (1ms)
  ✓ getGitSSHUrl should return URL containing protocol (5ms)

 PASS  __tests__/resolvers/exotics/github-resolver.js
  ✓ getGitSSHUrl with hash (2ms)
  ✓ getGitSSHUrl with no hash (1ms)
  ✓ getGitHTTPBaseUrl should return the correct git github HTTP base url
  ✓ getGitHTTPUrl should append ".git" to the HTTP base URL (1ms)
  ✓ getGitSSHUrl should return URL containing protocol (7ms)

 PASS  __tests__/commands/link.js
  ✓ creates folder in linkFolder (150ms)
  ✓ throws error if package.json does not have name (1ms)
  ✓ creates cmd file on Windows

 PASS  __tests__/util/guess-name.js
  guessName
    ✓ guess name of http://github.com/foo-bar/awesome-name (4ms)
    ✓ guess name of http://github.com/foo-bar/awesome-name.git (1ms)
    ✓ guess name of http://awesome.com/awesome-name.git
    ✓ guess name of http://awesome.com/awesome-name.git?foo/bar#fiz/fuz (1ms)
    ✓ guess name of https://github.com/hashicorp/awesome-name/archive/v0.5.5.tar.gz (3ms)
    ✓ guess name of https://gitlab.com/foo/awesome-name/repository/archive.tar.gz?ref=3.11.0
    ✓ guess name of https://gitlab.com/foo/awesome-name/repository/archive.tar.bz2?ref=3.11.0 (1ms)
    ✓ guess name of https://gitlab.com/foo/awesome-name/repository/archive.tar?ref=3.11.0
    ✓ guess name of https://gitlab.com/foo/awesome-name/repository/archive.zip?ref=3.11.0 (1ms)
    ✓ guess name of git@gitlab.com:yolo/awesome-name.git (1ms)
    ✓ guess name of https://gitlab.com/yolo/awesome-name.git (1ms)
    ✓ guess name of https://asesome.com/yolo/awesome-name-0.2.3.tar.gz
    ✓ guess name of /foo/bar/awesome-name (2ms)
    ✓ guess name of ./foo/bar/awesome-name (1ms)
    ✓ guess name of ../foo/bar/awesome-name (1ms)
    ✓ guess name of file:../foo/bar/awesome-name
    ✓ guess name of file:../foo/bar/awesome-name.tar.gz (1ms)
    ✓ guess name of awesome-name
    ✓ guess name of awesome-name.tar.gz
  guessName dot examples
    ✓ guess name of awesomename/awesome.name
    ✓ guess name of awesomename/awesome.name.git
    ✓ guess name of awesomename/awesome.name.tar.gz (1ms)
    ✓ guess name of awesomename/awesome.name.tar.bz2

 PASS  __tests__/reporters/event-reporter.js
  ✓ EventReporter.finished (5ms)
  ✓ EventReporter.step (2ms)
  ✓ EventReporter.log
  ✓ EventReporter.success (1ms)
  ✓ EventReporter.error (1ms)
  ✓ EventReporter.info
  ✓ EventReporter.command (1ms)
  ✓ EventReporter.warn (1ms)

 PASS  __tests__/util/conversion.js
  boolify
    ✓ should recognize "true" values (5ms)
    ✓ should recognize "false" values (1ms)
    ✓ should treat unrecognized values as "true" (1ms)
  boolifyWithDefault
    ✓ should return the default for empty values (1ms)
    ✓ should be consistent with boolify() for non-empty values (3ms)

 PASS  __tests__/hooks.js
  ✓ install should call the resolveStep hook (383ms)
  ✓ install should call the fetchStep hook (97ms)
  ✓ install should call the linkStep hook (139ms)
  ✓ install should call the buildStep hook (176ms)

 PASS  __tests__/commands/upgrade-interactive.js
  ✓ throws if lockfile is out of date (560ms)
  ✓ exits with success if no upgrades (1ms)

 PASS  __tests__/reporters/buffer-reporter.js
  ✓ BufferReporter.finished (6ms)
  ✓ BufferReporter.step (1ms)
  ✓ BufferReporter.log (1ms)
  ✓ BufferReporter.success (1ms)
  ✓ BufferReporter.error
  ✓ BufferReporter.info (1ms)
  ✓ BufferReporter.command (1ms)
  ✓ BufferReporter.warn (1ms)

 PASS  __tests__/util/path.js
  resolveWithHome
    ✓ Paths without home are resolved (1ms)
    !win32
      ✓ Paths with home are resolved (50ms)
    win32
      ✓ Paths with home are resolved (1ms)

 PASS  __tests__/util/promise.js
  ✓ promisify (4ms)
  ✓ queue (1ms)

 PASS  __tests__/commands/bin.js
  ✓ running bin without arguments should return the folder where the binaries are stored (107ms)
  ✓ running bin with a binary name as the argument should return its full path (863ms)

 PASS  __tests__/package-compatibility.js
  ✓ node semver semantics (31ms)
  ✓ ignore semver prerelease semantics for yarn (1ms)

 PASS  __tests__/util/env-replace.js
  environment variable replacement
    ✓ will replace a token that exists in the environment (5ms)
    ✓ will not replace a token that does not exist in the environment
    ✓ will not replace a token when a the token-replacement mechanism is prefixed a backslash literal (1ms)

 PASS  __tests__/resolvers/exotics/registry-resolver.js
  ✓ resolves unscoped npm: package (5ms)
  ✓ resolves scoped npm: package
  ✓ resolves unscoped yarn: package (1ms)
  ✓ resolves scoped yarn: package

 PASS  __tests__/util/parse-package-path.js
  ✓ parsePackagePath (6ms)
  ✓ isValidPackagePath (6ms)

 PASS  __tests__/commands/install/unit.js
  ✓ flat arg is inherited from root manifest (186ms)

 PASS  __tests__/commands/owner.js
  ✓ list should show owners (420ms)

 PASS  __tests__/util/blocking-queue.js
  ✓ max concurrency (3ms)

 PASS  __tests__/util/signal-handler.js
  ✓ should attach a handler for SIGTERM event (23ms)
  ✓ attached SIGTERM handler should exit with status code 1 when invoked (4ms)

 PASS  __tests__/util/root-user.js
  ✓ isRootUser (3ms)
  ✓ isFakeRoot (1ms)

 PASS  __tests__/util/colorize-diff.js
  colorizeDiff
    when `from` and `to` versions are identical
      ✓ returns from/to value (4ms)

 PASS  __tests__/util/parse-package-name.js
  ✓ parsePackageName (7ms)

 PASS  __tests__/constants.js
  ✓ getPathKey (4ms)

 PASS  __tests__/util/misc.js
  ✓ sortAlpha (3ms)

 PASS  __tests__/package-resolver.js (20.683s)
  ✓ resolve https://github.com/ocaml/ocaml-re (3443ms)
  ✓ resolve git+https://github.com/stevemao/left-pad.git#1.3.0
  ✓ resolve https://github.com/stevemao/left-pad.git#1.3.0
  ✓ resolve https://git@github.com/stevemao/left-pad.git
  ✓ resolve https://bitbucket.org/hgarcia/node-bitbucket-api.git (244ms)
  ✓ resolve https://github.com/yarnpkg/yarn/releases/download/v0.18.1/yarn-v0.18.1.tar.gz (16818ms)
  ✓ resolve https://github.com/yarnpkg/e2e-test-repo.git#greenkeeper/cross-env-3.1.4
  ✓ resolve https://github.com/bestander/chrome-app-livereload.git
  ✓ resolve livereload@https://github.com/bestander/chrome-app-livereload.git
  ✓ resolve bestander/chrome-app-livereload (1ms)
  ✓ resolve livereload@https://github.com/bestander/chrome-app-livereload/archive/0.0.5.tar.gz
  ✓ resolve gitlab:leanlabsio/kanban
  ✓ resolve gist:d59975ac23e26ad4e25b
  ✓ resolve bitbucket:hgarcia/node-bitbucket-api
  ✓ resolve scrollin (1ms)
  ✓ resolve gulp
  ✓ resolve react-native
  ✓ resolve ember-cli
  ✓ resolve npm:gulp (1ms)
  ✓ resolve @polymer/iron-icon
  ✓ offline resolve @foo/bar@1.2.3
  ✓ addPattern does not add duplicates

 PASS  __tests__/commands/install/bin-links.js (159.359s)
  ✓ install should hoist nested bin scripts (12555ms)
  ✓ direct dependency bin takes priority over transitive bin (11749ms)
  ✓ install should respect --no-bin-links flag (9916ms)
  ✓ newer transitive dep is overridden by newer direct dep (15786ms)
  ✓ newer transitive dep is overridden by older direct dep (13208ms)
  ✓ first transient dep is installed when same level and reference count (10986ms)
  ✓ first dep is installed when same level and reference count and one is a dev dep (10929ms)
  ✓ direct dependency is linked when bin name conflicts with transitive dependency (481ms)
  ✓ Only top level (after hoisting) bin links should be linked (60887ms)
  ✓ can use link protocol to install a package that would not be found via node module resolution (10755ms)
  ✓ empty bin string does not create a link (91ms)
  with nohoist
    ✓ nohoist bin should be linked to its own local module (990ms)
    ✓ nohoist bin should not be linked at top level, unless it is a top-level package (186ms)
  with focus
    ✓ focus points bin links to the shallowly installed packages (436ms)

Test Suites: 88 passed, 88 total
Tests:       3 skipped, 1197 passed, 1200 total
Snapshots:   117 passed, 117 total
Time:        315.879s
Ran all test suites.
✨  Done in 317.20s.